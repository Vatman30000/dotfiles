# ~/.tmux.conf

# === ОБЩИЕ НАСТРОЙКИ ===
set -g default-terminal "tmux-256color"
set -g mouse on
set -s escape-time 0
set -g focus-events on
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g history-limit 10000

# === ИЗМЕНЕНИЕ PREFIX ===
# По умолчанию Ctrl+b, но многие предпочитают Ctrl+Space или Ctrl+a
unbind C-b
set -g prefix C-p
bind C-p send-prefix

# === УПРАВЛЕНИЕ ПАНЕЛЯМИ ===
# Разделение окна вертикально (новая панель справа)
bind v split-window -h -c "#{pane_current_path}"

# Разделение окна горизонтально (новая панель внизу)
bind h split-window -v -c "#{pane_current_path}"

# Изменение размера панелей с префиксом (Ctrl+b + Shift+hjkl)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Циклический перебор макетов
bind Space next-layout
bind C-Space previous-layout

# Перемещение панели (Ctrl+b + { или })
bind '{' swap-pane -U
bind '}' swap-pane -D

# Отобразить номера панелей
bind q display-panes

# Переименование панели
bind , command-prompt -p "rename-pane: " -I "#P" "select-pane -t ':.#P' -T '%%'"

# Закрытие панели
bind x kill-pane

# Переключение на полноэкранный режим панели
bind f resize-pane -Z

# === УПРАВЛЕНИЕ ВКЛАДКАМИ (WINDOWS) ===
# Создание новой вкладки
bind n new-window -c "#{pane_current_path}"

# Переименование вкладки
bind r command-prompt -I "#W" "rename-window '%%'"

# Навигация между вкладками
bind -n M-n next-window
bind -n M-p previous-window

# Переключение на конкретную вкладку (1-9)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Закрытие вкладки
bind w kill-window

# === СЕССИИ ===
# Создание новой сессии
bind C-n new-session

# Отсоединение от сессии
bind d detach-client

# Переключение между сессиями
bind ( switch-client -p
bind ) switch-client -n

# === КОПИРОВАНИЕ И PASTE (VI MODE) ===
setw -g mode-keys vi
setw -g status-keys vi

bind e copy-mode
bind p paste-buffer

# Vi-style selection in copy mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection
bind -T copy-mode-vi Escape send -X cancel

# === СИНХРОНИЗАЦИЯ ПАНЕЛЕЙ ===
# Отправка команды всем панелям одновременно
bind C-s setw synchronize-panes

# === ПЕРЕЗАГРУЗКА КОНФИГА ===
bind R source-file ~/.tmux.conf \; display "Config reloaded!"


# Показывать номера панелей в левой части статус-бара
set -g pane-border-status off


# === НАСТРОЙКА STYLE ===
set -g status-position top 
set -g @catppuccin_flavor 'macchiato'
run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux
set -g pane-border-lines heavy
set -g pane-border-indicators off
set -g pane-border-status off

set -g @catppuccin_pane_border_style "##{?pane_in_mode,fg=#{@thm_lavender},##{?pane_synchronized,fg=#{@thm_mauve},fg=#{@thm_lavender}}}"
set -g @catppuccin_pane_active_border_style "##{?pane_in_mode,fg=#{@thm_lavender},##{?pane_synchronized,fg=#{@thm_mauve},fg=#{@thm_lavender}}}"
set -g status-right-length 100
set -g status-left-length 100
# set -g status-left "#{E:@catppuccin_status_session}"
set -g status-left ""

set-option -g status-left "\
#[fg=#{E:@thm_fg},bg=#{@thm_surface_0}] #S \
#[fg=#{@catppuccin_status_session_icon_fg},bg=#{?client_prefix,#{E:@thm_red},#{E:@thm_green}}] \
#[fg=#{@catppuccin_status_session_icon_fg},reverse]#[none]"
set-option -g status-justify absolute-centre
# set -g @catppuccin_window_text " #W"
# set -g @catppuccin_window_current_text " #W"
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_uptime}"
set -agF status-right "#{E:@catppuccin_status_battery}"

set -g @catppuccin_window_status_style "rounded"
# === НАСТРОЙКА ПЛАГИНОВ ===

set -g @plugin 'tmux-plugins/tpm'

# сюда же список плагинов, например:
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# ИНИЦИАЛИЗАЦИЯ TPM (обязательно в самом низу)
run '~/.tmux/plugins/tpm/tpm'
